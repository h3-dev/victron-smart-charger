<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Victron Smart Charger</title>
  <!-- Tailwind per CDN (für schnelle Tests) -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-neutral-100 text-neutral-900">
  <div class="max-w-5xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6">Victron Smart Charger</h1>

    <!-- Live-Status ------------------------------------------->
    <div id="status" class="mb-8 rounded-xl p-4 shadow bg-white">
      <h2 class="text-xl font-semibold mb-2">Live Status</h2>
      <p>SOC: <span id="soc">–</span>%</p>
      <p>Charge current: <span id="cur">–</span> A</p>
    </div>

    <!-- PV-Forecast ------------------------------------------->
    <div class="mb-8 rounded-xl p-4 shadow bg-white">
      <h2 class="text-xl font-semibold mb-2">PV Forecast (Wh)</h2>
      <table class="w-full text-left border">
        <thead><tr class="bg-neutral-200">
          <th class="px-2 py-1">Time</th><th class="px-2 py-1">Wh</th></tr></thead>
        <tbody id="forecast"></tbody>
      </table>
    </div>

    <!-- Charging Plan ----------------------------------------->
    <div class="rounded-xl p-4 shadow bg-white">
      <h2 class="text-xl font-semibold mb-2">Charging Plan (A)</h2>
      <table class="w-full text-left border">
        <thead><tr class="bg-neutral-200">
          <th class="px-2 py-1">Time</th><th class="px-2 py-1">A</th></tr></thead>
        <tbody id="plan"></tbody>
      </table>
    </div>
  </div>

<script>
async function loadData() {
  const [status, forecast, plan] = await Promise.all([
    fetch("/status").then(r => r.json()),
    fetch("/forecast").then(r => r.json()),
    fetch("/charging-plan").then(r => r.json())
  ]);

  // Live-Status
  document.getElementById("soc").textContent = status.soc ?? "–";
  document.getElementById("cur").textContent = status.current_a ?? "–";

  // Forecast-Tabelle
  const fcBody = document.getElementById("forecast");
  fcBody.innerHTML = "";
  forecast.forEach(([ts, wh]) => {
    fcBody.insertAdjacentHTML("beforeend",
      `<tr><td class="px-2 py-1">${ts}</td><td class="px-2 py-1">${wh}</td></tr>`);
  });

  // Charging-Plan-Tabelle
  const plBody = document.getElementById("plan");
  plBody.innerHTML = "";
  Object.entries(plan).forEach(([ts, amp]) => {
    plBody.insertAdjacentHTML("beforeend",
      `<tr><td class="px-2 py-1">${ts}</td><td class="px-2 py-1">${amp}</td></tr>`);
  });
}
loadData();
setInterval(loadData, 60_000);   // alle 60 s aktualisieren
</script>
</body>
</html>
